---
title: 香橙
date: 2025-10-29 16:28:52
tags:
---


<div style="text-align:center;">
  <button id="startCam">打开摄像头</button>
  <button id="snapBtn">拍照</button>
  <button id="styleBtn">风格化照片</button><br>
  <video id="video" width="320" height="240" autoplay style="display:none;"></video>
  <canvas id="canvas" width="320" height="240"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>
<script>
let model = null;
tf.loadGraphModel('model/model.json').then(m => { model = m; }); // 替换为你的动画化模型tfjs路径

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let lastPhoto = null;

document.getElementById('startCam').onclick = async function() {
  video.style.display = 'block';
  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;
};

document.getElementById('snapBtn').onclick = function() {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  lastPhoto = ctx.getImageData(0, 0, canvas.width, canvas.height);
  alert('已拍照，可点击风格化照片！');
};

document.getElementById('styleBtn').onclick = async function() {
  if (!lastPhoto) {
    alert('请先拍照！');
    return;
  }
  if (model) {
    let input = tf.browser.fromPixels(lastPhoto).toFloat().div(127.5).sub(1.0).expandDims(0);
    let output = await model.executeAsync(input);
    let outImg = output.squeeze().add(1.0).mul(127.5).clipByValue(0,255).toInt();
    await tf.browser.toPixels(outImg, canvas);
    input.dispose(); output.dispose(); outImg.dispose();
    alert('风格化完成！');
  } else {
    alert('模型未加载完成！');
  }
};
</script>